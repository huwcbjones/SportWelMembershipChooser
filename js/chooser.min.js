function loadingStatus(){var e=$("#loading");3===e.text().length?e.text(""):e.text(e.text()+"."),loadingTimer=setTimeout(loadingStatus,250)}var Chooser={};Chooser.data={},Chooser.data.payg={},Chooser.data.membership={};var priceMap,membershipMap;Chooser.options={},Chooser.options.subscriptions={},Chooser.options.membershipType=null,Chooser.options.auTeam=null,Chooser.options.facilities=[],Chooser.options.frequency={},Chooser.history={},Chooser.history.currentPage="membership",Chooser.history.previousPage=null,$(document).ready(function(){$("#membershipGroup").on("click","input[name=membership]",function(){Chooser.options.membershipType=this.value}),$("#auTeamGroup").on("click","input[name=auTeam]",function(){Chooser.options.subscriptions.sp="1"===this.value,Chooser.options.auTeam="1"===this.value}),$("#facilitiesGroup").on("click","input[name=facilities]",function(){var e=this.value,o=(Chooser.data.getItem(e),$("#freq-"+e));if(!0===$(this).prop("checked"))Chooser.options.facilities.push(e),Chooser.options.frequency[e]={time:0,peak:!1},o.removeClass("hidden");else{var s=Chooser.options.facilities.indexOf(e);s>-1&&Chooser.options.facilities.splice(s,1),null!==Chooser.options.frequency[e]&&delete Chooser.options.frequency[e],o.addClass("hidden")}o.on("click","input[type=radio]",function(){Chooser.options.frequency[e].time=this.value}),o.on("click","input[type=checkbox]",function(){Chooser.options.frequency[e].peak=$(this).prop("checked")})})}),Chooser.init=function(){Chooser.data.getItem=function(e){var o=e.split("-"),s=Chooser.data.payg[o[0]];if("undefined"===s)return null;var i=s.index[o[1]];return"undefined"===i?null:s.items[i]};var e=$("#membershipTypes");for(var o in Chooser.data.membership)Chooser.data.membership.hasOwnProperty(o)&&"function"!=typeof Chooser.data.membership[o]&&e.append('<label class="checkbox">\n    <input type="radio" name="membership" value="'+o+'" id="membershipStudent" required/>\n'+Chooser.data.membership[o].display+"\n</label>");var s,i,r,t=$("#frequencyTable"),a=$("#facilities-jsc"),n=$("#facilities-rest");for(o in Chooser.data.payg)if(Chooser.data.payg.hasOwnProperty(o)){s="jsc"===o?a:n,(r=Chooser.data.payg[o]).index={},s.append("<h4>"+r.display+"</h4>");for(var p in r.items)if(r.items.hasOwnProperty(p)){i=Chooser.data.payg[o].items[p],r.index[i.id]=p;var d="#facilities-"+o+"-"+i.id;0!==i.requires.type.length&&$("#membershipGroup").on("click","input[name=membership]",{selector:d,requires:i.requires.type},function(e){e.data.requires.includes(Chooser.options.membershipType)?$(e.data.selector).removeClass("hidden"):$(e.data.selector).addClass("hidden")}),0!==i.excludes.type.length&&$("#membershipGroup").on("click","input[name=membership]",{selector:d,excludes:i.excludes.type},function(e){e.data.excludes.includes(Chooser.options.membershipType)?$(e.data.selector).addClass("hidden"):$(e.data.selector).removeClass("hidden")}),s.append('<label class="checkbox" id="facilities-'+o+"-"+i.id+'">\n  <input type="checkbox" name="facilities" value="'+o+"-"+i.id+'">\n'+i.display+"\n</label>"),t.append('<tr id="freq-'+o+"-"+i.id+'" class="hidden">\n  <th>'+i.display+'</th>\n  <td><input type="radio" name="frequency-'+o+"-"+i.id+'" value="1"/></td>\n  <td><input type="radio" name="frequency-'+o+"-"+i.id+'" value="12"/></td>\n  <td><input type="radio" name="frequency-'+o+"-"+i.id+'" value="26"/></td>\n  <td><input type="radio" name="frequency-'+o+"-"+i.id+'" value="52"/></td>\n  <td><input type="radio" name="frequency-'+o+"-"+i.id+'" value="365"/></td>\n  <td><input type="radio" name="frequency-'+o+"-"+i.id+'" value="0" checked/></td>\n  <td><input type="checkbox" name="peak-'+o+"-"+i.id+'"/></td>\n</tr>')}s.append("<br />")}},Chooser.goToSportsTeams=function(){if(null===this.options.membershipType)return $("#membershipGroup").addClass("has-error"),void $("#membershipHelp").removeClass("hidden");$("#membershipGroup").removeClass("has-error"),$("#membershipHelp").addClass("hidden");var e="sports-teams";"child"===this.options.membershipType&&(e="facilities"),Chooser.swapPage(e)},Chooser.goToFacilities=function(){if(null===this.options.auTeam)return $("#auTeamGroup").addClass("has-error"),void $("#auHelp").removeClass("hidden");$("#auTeamGroup").removeClass("has-error"),$("#auHelp").addClass("hidden"),Chooser.swapPage("facilities")},Chooser.goToFrequency=function(){0===Chooser.options.facilities.length?Chooser.calculateResult():Chooser.swapPage("frequency")},Chooser.swapPage=function(e){var o=Chooser.history.currentPage,s=$("#"+e+"-panel"),i=$("#"+o+"-panel"),r=$("#result");switch(e){case"sports-teams":"child"===Chooser.options.membershipType?"facilities"===o?$("#membership-panel").collapse("show"):$("#facilities-panel").collapse("show"):s.collapse("show"),i.collapse("hide");break;case"results":r.fadeIn(500);default:"results"===o&&r.fadeOut(500),s.collapse("show"),i.collapse("hide")}Chooser.history.previousPage=o,Chooser.history.currentPage=e},Chooser.calculateResult=function(){var e=Chooser.calculatePAYG(),o=e[0],s=e[1],i=o-s,r=Chooser.data.membership[Chooser.options.membershipType],t=$("#resultType"),a=$("#resultPrice");if($("#resultLink").attr("href",r.link),t.val(r.display),"child"===Chooser.options.membershipType){Chooser.addInfo("Selected child membership...\n");var n=r.child.price;return"month"===r.child.type&&(n*=12),o<=n?(Chooser.addInfo("PAYG is cheaper than child by £"+(n-o).toFixed(2)+"\n"),t.val(t.val()+" - PAYG"),a.val("£"+o+" (estimated)"),Chooser._printSubscription(r.display,"Pay As You Go",o)):(Chooser.addInfo("Child is cheaper than PAYG by £"+(o-n).toFixed(2)+"\n"),t.val(t.val()+" - "+r.child.display),a.val("£"+r.child.price+" ("+r.child.type+"ly)"),Chooser.printSubscription(r,"child")),void Chooser.swapPage("results")}Chooser.selectAvailableSubscriptions(),Chooser.addInfo("\n========================================\n"),Chooser.addInfo("                AU Team                 \n"),Chooser.addInfo("========================================\n"),Chooser.addInfo("Subscription requires AU use: "+(Chooser.options.auTeam?"Yes":"No")+"\n");var p=r.sp.price,d=r.ff.price,l=r.pp.price,h=r.wc.price;if("month"===r.sp.type&&(p*=12),"month"===r.ff.type&&(d*=12),"month"===r.pp.type&&(l*=12),"month"===r.wc.type&&(h*=12),Chooser.addInfo("\n========================================\n"),Chooser.addInfo("             Cost per Year              \n"),Chooser.addInfo("========================================\n"),Chooser.addInfo("Workout Central:  £"+h.toFixed(2)+(!1===Chooser.options.subscriptions.wc?"*":"")+"\n"),Chooser.addInfo("Sports Pass:      £"+p.toFixed(2)+(!1===Chooser.options.subscriptions.sp?"*":"")+"\n"),Chooser.addInfo("Frequent Fitness: £"+d.toFixed(2)+(!1===Chooser.options.subscriptions.ff?"*":"")+"\n"),Chooser.addInfo("Peak Performer:   £"+l.toFixed(2)+(!1===Chooser.options.subscriptions.pp?"*":"")+"\n"),Chooser.addInfo(" * does not meet requirements\n"),Chooser.options.auTeam&&(!0===Chooser.options.subscriptions.sp||p+i<=d&&p+s<=l))return 0===o?(t.val(t.val()+" - "+r.sp.display),a.val("£"+r.sp.price+" ("+r.sp.type+"ly)"),Chooser.printSubscription(r,"sp")):(t.val(t.val()+" - "+r.sp.display+" + PAYG"),a.val("£"+r.sp.price+" ("+r.sp.type+"ly) - £"+o+" (estimated PAYG)"),Chooser.printSubscription(r,"sp",o)),void Chooser.swapPage("results");console.log(o),console.log(s);var c=Chooser.calculateWCPAYG(o,s),u=c[0],C=c[1],f=u-C;if(!0===Chooser.options.subscriptions.wc&&h+f<=d&&h+C<=l)return 0===u?(t.val(t.val()+" - "+r.wc.display),a.val("£"+r.wc.price+" ("+r.wc.type+"ly)"),Chooser.printSubscription(r,"wc")):(t.val(t.val()+" - "+r.wc.display+" + PAYG"),a.val("£"+r.wc.price+" ("+r.wc.type+"ly) - £"+u+" (estimated PAYG)"),Chooser.printSubscription(r,"wc")),void Chooser.swapPage("results");l<=d+s?(t.val(t.val()+" - "+r.pp.display),a.val("£"+r.pp.price+" ("+r.pp.type+"ly)"),Chooser.printSubscription(r,"pp")):d<=o?0!==s?(t.val(t.val()+" - "+r.ff.display+" + PAYG"),a.val("£"+r.ff.price+" ("+r.ff.type+"ly) - £"+s+" (estimated PAYG)"),Chooser.printSubscription(r,"ff",s)):(t.val(t.val()+" - "+r.ff.display),a.val("£"+r.ff.price+" ("+r.ff.type+"ly)"),Chooser.printSubscription(r,"ff")):(t.val(t.val()+" - Pay As You Go"),a.val("£"+o+" (estimated PAYG)"),Chooser._printSubscription(r.display,"Pay As You Go",o)),Chooser.swapPage("results")},Chooser._printSubscription=function(e,o,s){Chooser.addInfo("\n========================================\n"),Chooser.addInfo("      Best Membership/Subscription      \n"),Chooser.addInfo("========================================\n"),Chooser.addInfo(" Membership:    "+e+"\n"),Chooser.addInfo(" Subscription:  "+o+"\n"),Chooser.addInfo(" £/year (est):  £"+("      "+s.toFixed(2)).slice(-6)+"\n"),Chooser.addInfo(" £/month (est): £"+("      "+(s/12).toFixed(2)).slice(-6)+"\n")},Chooser.printSubscription=function(e,o,s){if(void 0!==s)Chooser._printSubscription(e.display,e[o].display+" + PAYG",e[o].price+s);else{var i=e[o].price;"month"===e[o].type&&(i*=12),Chooser._printSubscription(e.display,e[o].display,i)}},Chooser.selectAvailableSubscriptions=function(){var e,o;Chooser.options.subscriptions={wc:!0,sp:!0,ff:!0,pp:!0};for(var s in Chooser.options.facilities){if(0!==(e=Chooser.data.getItem(Chooser.options.facilities[s])).excludes.length)for(o in e.excludes.sub)e.excludes.sub.hasOwnProperty(o)&&(Chooser.options.subscriptions[e.excludes.sub[o]]=!1);if(0!==e.requires.length)for(o in e.requires.sub)e.requires.sub.hasOwnProperty(o)&&(Chooser.options.subscriptions[e.requires.sub[o]]=!0)}Chooser.options.auTeam?Chooser.options.subscriptions.wc=!1:Chooser.options.subscriptions.sp=!1},Chooser.calculateWCPAYG=function(e,o){var s;return-1!==Chooser.options.facilities.indexOf("may-gym")&&(s=Chooser.data.getItem("may-gym").price*Chooser.options.frequency["may-gym"].time,0!==e&&(e-=s),0!==o&&(o-=s)),-1!==Chooser.options.facilities.indexOf("may-classes")&&(s=Chooser.data.getItem("may-classes").price*Chooser.options.frequency["may-classes"].time,0!==e&&(e-=s),0!==o&&(o-=s)),[e,o]},Chooser.calculatePAYG=function(){Chooser.addInfo("========================================\n"),Chooser.addInfo("           Pay As You Go Cost           \n"),Chooser.addInfo("========================================\n");var e,o=0,s=0;for(var r in Chooser.options.frequency)if(Chooser.options.frequency.hasOwnProperty(r)){var t=Chooser.data.getItem(r),a=Chooser.options.frequency[r];o+=e=t.price*a.time,a.peak&&(s+=e);var n=":    ";if(t.display.length<25)for(i=0;i<25-t.display.length;i++)n+=" ";else n="...: ";if(Chooser.addInfo(" "+t.display.substring(0,25)+n+"£"+("       "+e.toFixed(2)).slice(-7)+(a.peak?"*":"")+"\n"),0!==t.excludes.sub.length)for(var p in t.excludes.sub)Chooser.options.subscriptions[t.excludes.sub[p]]=!1;if(0!==t.requires.sub.length){for(p in Chooser.options.subscriptions)Chooser.options.subscriptions.hasOwnProperty(p)&&(Chooser.options.subscriptions[p]=!1);for(p in t.requires.sub)Chooser.options.subscriptions[t.requires.sub[p]]=!0}}return Chooser.addInfo(" * indicates peak time\n"),Chooser.addInfo("\nSubtotal:\n"),Chooser.addInfo(" Off Peak: £"+("       "+(o-s).toFixed(2)).slice(-7)+"\n"),Chooser.addInfo(" On Peak:  £"+("       "+s.toFixed(2)).slice(-7)+"\n"),Chooser.addInfo("Total:     £"+("       "+o.toFixed(2)).slice(-7)+"\n"),[o,s]},Chooser.additionalInfo=$("#additionalInfo"),Chooser.addInfo=function(e){Chooser.additionalInfo.append(e)};var loadingTimer=setTimeout(loadingStatus,250);$.getJSON("data.json",function(e){console.log("Loaded data!"),Chooser.data=e,$("#loadingStatus").remove(),clearInterval(loadingTimer),Chooser.init()});